# 为公共内网穿透运营商配置
## 准备材料
1. 你的运行着被穿透的服务的服务器，Linux/Windows/macOS系统，无需公网，能联网即可
2. **可能**需要内网穿透服务的个人帐号剩余至少能新建一条frp隧道的额度，你的情况是否需要请见下文适用范围
3. **可能**需要有属于自己的域名，你的情况是否需要下文适用范围
4. 最起码的耐心
5. 懂得配置SSL证书的方法

## 适用范围和对应操作方式

### 无法准备好适用于第一条/第四条的材料

你的情况不适于本教程

### 没有自己的域名，且内网穿透服务没有新建隧道额度

#### 条件要求

1. 你需要将当前的一条**HTTP**类型的隧道（无需输入端口号，直接通过域名访问的那种）（都已经能通过域名访问了，证明你至少有一个域名，即使它是由内网穿透运营商分配的，极其被动以至于只能绑定到内网穿透隧道上）升级到**HTTPS**隧道
2. 你穿透的HTTP服务是一个**Web服务**，例如使用了Nginx、Apache，或者服务端软件是由你自己编写且协议是普通的HTTP。一个典型的不适用于该场景的协议是WebSocket。
3. 你选择的CA支持HTTP-01挑战

#### 具体方案

1. 为你用于访问那个隧道的域名申请证书
2. 将证书验证文件（不是证书本体）按照CA或证书自动更新工具的指引放置在网页服务器指定位置
3. 按照内网穿透服务商的指示上传或安装或放置证书文件

### 域名可以只能再创建一条解析，且内网穿透帐号无法再新建隧道

#### 条件要求

1. 域名可再新建的解析记录可以有任何记录值、任何主机记录并可创建TXT类型
2. 你已经有一条域名通过CNAME类型解析指向了你要升级到HTTPS、非80端口的、原来是以HTTP协议工作的TCP隧道
3. 你选择的CA支持DNS-01挑战
4. 你的内网穿透运营商支持将被穿透的不支持HTTPS协议的、服务协议实际上为HTTP协议的TCP隧道升级为支持HTTPS协议且可以使用自己的SSL证书（很多运营商都管这个功能叫自动HTTPS）
   
#### 具体方案

1. 为你的指向那个已有的TCP隧道的域名申请证书
2. 按照CA或证书自动更新工具的指引为域名创建一条用于DNS-01挑战的解析
   
### 域名可以再创建最多两条解析，但内网穿透帐号无法再新建隧道

#### 条件要求

1. 域名可再新建一条解析记录，该解析记录可以有任何记录值、任何主机记录并可创建TXT类型。
2. 域名可再新建另一条解析记录，该解析记录可以有任何记录值、任何主机记录并可创建CNAME类型。
3. 你选择的CA支持DNS-01挑战
4. 你的内网穿透运营商支持将被穿透的不支持HTTPS协议的、服务协议实际上为HTTP协议的TCP隧道升级为支持HTTPS协议且可以使用自己的SSL证书（很多运营商都管这个功能叫自动HTTPS）

#### 具体方案

1. 创建一条CNAME类型的指向你要升级到HTTPS的那条TCP隧道的解析
2. 按照CA或证书自动更新工具的指引为域名创建一条用于DNS-01挑战的解析

### 域名没有新建解析的额度，但内网穿透可新建一条隧道

#### 条件要求

1. 内网穿透运营商方面可以继续在你要升级到HTTPS的、非80端口的、原来是以HTTP协议工作的TCP隧道的**同一节点**新建HTTPS类型隧道（比如仍然有可建站节点可供新建隧道）
2. 你的内网穿透帐号剩余的那一条隧道的额度可用于创建HTTPS类型隧道
3. 你已经有一条域名通过CNAME类型解析指向了你要升级到HTTPS的、非80端口的、原来是以HTTP协议工作的TCP隧道
4. 你选择的CA支持HTTP-01挑战

#### 具体方案

1. 在你的服务器上开一个nginx或apache服务
2. 在你要升级到HTTPS的那条TCP隧道的**同一穿透节点**新建一条隧道，指向刚刚新建的nginx或apache服务器
3. 将证书验证文件（不是证书本体）按照CA或证书自动更新工具的指引放置在nginx或apache服务器指定位置
4. 按照内网穿透服务商的指示上传或安装或放置证书文件
