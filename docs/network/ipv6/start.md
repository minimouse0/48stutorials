# 开通IPv6方法总结
网上有大把教程，但是因为其中很多写的模棱两可，或者已经失效，我在下面提供一些关键词和简单的讲解，给萌新们提供一些思路。  
本文从前到后以时间倒序排序，除非教程中有无效的方法，否则均只推荐看最新时间节点的教程。  
> [!TIP]
> 之所以针对各个时间点单独写教程，是因为运营商的策略一直在变，很多方法都有时效性，你在这篇文章看到的方法不一定完全有效。折腾开服建站相关的东西，每个人都应该具有独立思考的能力和一定的动手能力，以及充足的耐心，这对你无论折腾什么都有很大帮助。

> [!NOTE]
> 解决方案仅为本人初步探究，部分内容为实验结论，没有找到理论支持，如果有不足之处欢迎指正。

## 2023
#### 检查是否已经有IPv6地址
如果是windows系统，先打开任务管理器，点击性能选项卡，侧边栏找到以太网点击，下面的信息如果有显示IPv6地址，而且前缀不是fe80，那基本就证明是已经有IPv6了。国内绝大多数都是2408 2409 240e开头，如果是其他的你也可以百度一下这个开头，没有说是内网地址或者虚拟机就行  
#### 云服务器
如果你使用的是从其他运营商购买的云服务器，可以去他们的使用文档里查找开启IPv6的教程。如果文档太多或者他给的分类你不是很理解，可以去找文档站里面的搜索按钮，一般都会有提供，搜索IPv6或者ipv6（大小写都搜一下，有些搜索引擎不是很智能），应该就会找到。如果实在找不到，就得去问运营商了。有些运营商会给你开，有些不会，理由可能是网络设备不支持什么的，反正运营商说不行的话你就可以放弃了。  
#### 家宽
如果你是家里云，需要先检查一下路由器的设置。有的时候宽带已经支持IPv6，但是路由器并没有开启。路由器如何开启IPv6可以百度搜索路由器品牌+怎么开IPv6 。这里给出常见的华为路由器和tplink路由器的开启方法  
- 华为路由器：登录后台之后，点击顶部更多功能，侧边栏找到网络设置点击展开，选择IPv6，打开开关，下面所有选项全选择自动配置，点击保存。切换到侧边栏里面的路由器信息页面，如果IPv6那一段显示出来的地址里面有不是fe80这种的IPv6地址（可能也会有fe80开头的，别全都是就行），那就是成功开启了IPv6.  
- tplink路由器：登录后台后点击底部路由设置，侧边栏找到IPv6设置点击，IPv6功能调整为开启，WAN口连接类型选择自动获取IP地址，点击保存。我没有tplink路由器，不清楚怎么找IPv6地址，总之找到IPv6地址之后，跟上段华为路由器要求的效果一样就行。  

如果按照上面的方法设置之后路由器里也显示fe80的地址，证明你的光猫也需要配置，或者宽带不支持IPv6 。现在仍然有一些小运营商和一些地区不支持IPv6，因为网络铺设的成本在那，IPv6的普及还需要时间。
#### 检查路由器上网方式
此时先打开路由器的后台，查看路由器的上网方式。不会操作可以百度路由器品牌+怎么设置拨号上网。华为路由器点击顶部“我要上网”就可以看到上网方式，tplink路由器点击底部路由设置，侧边栏找到上网设置，就可以看到上网方式。如果这一步设置的是DDNS（自动获取IP地址），那就需要修改光猫设置。如果这一步设置的已经是拨号上网（PPPOE），那就证明你的运营商没有给你开IPv6或者不支持IPv6，你就可以直接跳过下面修改光猫的步骤，直接跟运营商报修说要开通IPv6。  
> [!TIP]
> 之前听有的网友说报修的时候尽量直接给安装师傅打电话，不要给运营商打电话走报修流程，说是这样会影响安装师傅业绩，导致他对你家印象不好  

#### 修改光猫为桥接 
下面需要修改光猫设置。如果安装师傅没给你超级密码，此时有以下三种解决办法：  
1. （成功率最高，但需要花钱）在某宝某多搜索“光猫超级密码”，会有很多破解光猫超级密码的服务。这里有没有水深的情况我不清楚，我也没研究过，但是确实有些人在用这个途径，比较有效。  
2. （完全自行操作，社恐患者福音）在搜索引擎搜索自己的运营商+光猫品牌+超级密码，然后在光猫后台挨个试。这是一个很漫长的过程，因为每个地区的运营商的默认超级密码都不同，甚至有可能你那边的运营商给你的密码是完全随机的，因此你在网上找到的大多数密码可能都不能用。  
有了超级密码之后，登录光猫后台，先记下原来的帐号密码，然后将上网方式修改为桥接。运营商的光猫型号众多，没有主流的后台界面，这里需要大家上网搜索光猫型号（在光猫的外壳，后台界面，底部的铭牌都有可能看到）+怎么改桥接，并根据实际情况灵活应对。这里对动手能力要求很高，单凭这个教程很难讲明白。  
3. 如果你搞不到超级密码，也可以直接报修，跟安装师傅说你要改桥接。大部分都会直接给改，一部分运营商的安装师傅会说需要给你报备，我家这个就是，我电话说完之后他说要给我报备，报备之后才能改桥接。  
#### 使用路由器拔号
光猫改成桥接之后，进入路由器后台，将按上文查看上网方式的方法找到上网方式，改成拨号上网（PPPoE），填入在光猫后台找到的帐号密码并保存。此时你家宽带的质量应该会有所提升，毕竟这次网关给到了路由器，自己的路由器性能一般都比运营商给的那个光猫的要好。此外一部分用联通电信宽带的路由器应该会直接有IPv4公网了。如果你是联通电信但仍然没有IPv4公网，可以报修说让他给开一下，一些地方是可以给开的，一些地方会要求额外收费，或者直接不给开，毕竟IPv4资源紧缺，运营商能靠商宽捞一笔。这时候再去查看IPv6的情况，如果仍然没有，就可能是需要联系运营商开，或者运营商不支持了。  
#### 测试IPv6可用性
折腾完路由器之后，回到服务器上，任务管理器里应该就显示公网v6地址了。要测试这个v6是不是真的生效了，可以访问ipw.cn或testipv6.cn测试。  
自此服务器的IPv6已经全部配置完毕了。
#### 开通IPv6之后的额外注意事项
 - 如果需要用到IPv6的公网，需要合理配置防火墙。服务器操作系统也带一个防火墙，部分路由器的防火墙也对IPv6生效，因此如果有IPv6了但仍然连不上服务，把路由器和服务器的防火墙都关了看看，或者改一下防火墙放行的规则。如果是4g5g那种路由器，大部分运营商在大部分地区都会开启防火墙，导致手机流量上网有IPv6地址也能访问IPv6服务但无法把很大一部分服务开放到公网。一些服务器软件本身也不支持IPv6访问，但是其中一些可能是近期才开始支持所以需要你更新到新版。
 - Linux和macOS要ping IPv6地址，需要用ping6命令，nslookup的时候也要加参数-type=AAAA，比如`ping6 fe80::1`；Windows要ping IPv6地址，需要给ping命令加-6参数，比如`ping -6 fe80::1`  
 - dns方面，IPv6的类型是AAAA，所以设置解析也需要用AAAA类型。大部分家宽的IPv6默认是动态的，如果需要将服务开放到公网，可以先尝试[固定IPv6地址](network/ipv6/fixedip)，如果自己的运营商限制或网络环境原因无法固定IP，需要配置ddns后用域名访问。我自己用的是ddns-go，这个需要自己有域名才行，不一定是最适合你的ddns软件，各位需要根据实际需求选择。
 - 先前有一定基础的读者都知道IPv6正常工作时会获取到很多IP。这些IP不一定适用于所有服务，比如一些服务必须要用那个隐私保护IP才行。电脑获得的所有IPv6地址可以在命令行中用`ipconfig`命令查看。
 - 家宽不要在公网建站，任何网站，就连软件的管理面板或者nas这些都不行，之前已经有过不少因为家宽把管理面板开放到公网结果被运营商警告的例子了。  
