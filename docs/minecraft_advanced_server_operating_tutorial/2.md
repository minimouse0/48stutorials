# 【我的世界进阶开服教程】2:为什么我的服务器没人?看了这篇教程,原来开服确有诀窍,但并不是我想的那样
本系列文章目前在MineBBS、b站、知乎同时发表  
**如果你是连服务器都没成功开起来过的小白，那么我建议你到各大平台搜索“我的世界开服教程”，根据教程操作，直到你做到自己开设的服务器能够让你自己连接并在里面正常游戏  
注意：我的世界分Java版和基岩版，基岩版不能直接进入Java版服务器，Java版也不能直接进入基岩版服务器！首先确保你能完全分清Java版和基岩版，然后再学习开服。​**  
**我有的时候会忘更新我的文章，可以直接在文章下面评论催更，或者加我的群715732100联系我，或者和我一起讨论开服吧**  
**由于本文需要跨平台发表，因此格式化的内容较少，还请各位读者谅解！**  
上回说到服务器的硬件（计算资源），这次来讲网络  
之所以我把网络和硬件分开来讲，是因为网络这里的说道实在是太多了，完全可以跟硬件的内容并列  
## 广域网和局域网
在计算机发展初期，计算机学家们用电线把电脑连接在一起让他们互相传输数据，网络就出现了。这样连在一起的电脑变多，就出现了互联网。后来人们铺设电缆让这个互联网扩大范围，直至把全世界的电脑连接在一起，因特网(Internet)就出现了。  
因特网是个好东西，它模糊了人与人之间距离的概念，让人们相隔距离很远也可以互相联系。然而这样的因特网还有一个问题：因特网上的计算机太多，很不好管理。因此局域网就和因特网结合到了一起。把同一个地点的电脑连接在一起，就是一个局域网，然后再把这个局域网连接到因特网。在同一个局域网里的电脑可以互相信任，互相敞开心扉允许被对方搜索到。而他们可以对外一致提高警戒，防止被来自因特网上其他计算机攻击。这其中，广域网有一个别称叫公网，局域网有一个别称叫私网。  
## 网络五层模型、IP、TCP和UDP协议
你有没有想过，网线只能传输电信号，电脑是怎么用这一根根电线传输如此复杂的信息的？为了互相通信，计算机之间也有一种“语言”，这种语言就是协议。网线中传输的只有电流，如何通过电流表达信息呢？可以通过控制电流的状态来表达这些信息，如果用没有电流代表0，有电流代表1，并规定一个数字逢二进一，例如10表示2，11表示3，数字就表达出来了。网络设备中负责改变网线中有无状态工作的软硬件就工作在**物理层**。像你家里的网线，和入户的网线和光纤，都可以理解为工作在物理层。  
在规定好信号通断为0和1后，计算机还需要规定如何用0和1传递复杂的数据。例如计算机需要通过网络发送5和8，那么它需要让网络设备在网线上发出“101”和“1000”两个信号，可以对方接收信号的时候，要怎么知道这是5和8？如果连在一起发送1011000，那么对方该如何分割这段信息就变得很棘手：到底是分成10，11，00，还是分成1011和000？既然不知道如何分割长度，那就不要决定长度了，所有的数字全都用同一个长度表示好了，至于更高位没有数字就用0表示。例如要发送5，那么就是000...0101。这样对方收到消息之后，就每隔多少位数字分割一下，再从里面提取数字就可以了。负责把各种数字转化成信号的网络设备和软件就工作在**链路层**。交换机和AP（路由器上发射wifi信号的模块）就工作在链路层，用来标识网卡身份的mac地址也工作在链路层。  
在规定好如何传递数字后，电脑还需要知道哪些数字组合在一起能够形成一段“话”，这样的一段“话”用来给对方传达一个完整的信息，例如当前的时间，向别人发送的消息，以及你在mc服务器里进行的挖方块，攻击生物等动作。这样的一段“话”就是数据包。此外电脑还需要把这些数据包打上标记，标记他们应该被发送给哪些电脑，不应该被发送给哪些电脑，应该通过什么样的方式发送给其他电脑。负责这些工作的网络设备和软件就工作在**网络层**。路由器、IP地址和ICMP协议（ping命令的原理）就工作在这一层。  
在规定好数据包应该长什么样了之后，还需要规定这些数据包应该怎么样进行传输，发送得错了或者丢了怎么办。计算机可以选择多次发送同一个数据包来保证数据包安全到达，也可以选择发完就不管了，你爱收不收反正我发给你了。负责控制这些发送数据包行为的软件工作在**传输层**，tcp和udp协议都工作在这一层。  
规定好发送数据包的行为后，还需要规定电脑上的软件应该如何处理这些数据包，这些数据包的格式是什么样的，如何排列。如果说链路层的那些0和1的长度是硬件之间的语言，那么这些数据包的格式就是软件之间的语言。这一层叫**应用层**，http、ftp、websocket、smb、我的世界服务器用的协议都工作在这一层。  
## 什么是服务端和客户端
电脑在互联网上通信的方式就像打电话一样，同样有一个打电话的人和一个接电话的人。在我们平时打电话的时候，接电话的人必须在线，也就是说有信号，或者插着电话线，打电话的人拨通电话后，接电话的人的铃声才会响起。如果打电话的时候对方没信号或者关机了，电话就根本拨不通，提示“您拨打的电话已关机”。在互联网上电脑和服务器通信也是一样，服务器上运行的服务端软件就是接电话的人，而你的电脑上的客户端，也就是游戏，就是打电话的人。
## IP地址、端口和套接字
为了让互联网上的每台电脑都有一个身份，IP协议规定要为每台电脑都分配一个地址，这个地址就是**IP地址**。之所以这种地址叫“IP”地址，是因为它是IP协议中的一个概念。当时你在云服务器上开服的时候，输入的那个用点连接的四个数字就是IP地址。就像去别人家串门需要知道他家的地址一样，在计算机上访问其他电脑需要知道它的IP地址。这样，电脑才能向正确的目标发送和接收数据包。用上文的例子理解，IP地址就是电话号，客户端需要知道IP地址这个“电话号”，然后才能向服务器“拨打电话”。但是这带来了一个问题，在我们打电话时，是不可以同时给很多个人打电话的，我们的电话一旦拨通就无法同时启动别的通话，要想启动别的通话只能把当前的通话进入等待状态，然后再拨通其他电话；而如果其他人打电话进来，就会拨不通，提示“您拨打的电话正在通话中”，或者提示你稍等一会，如果提示你需要稍等了，那么对方的电话会提示你打了电话进来，并让他选择挂断你们其中一人的电话或者让你们其中一人的电话进入等待状态。这么“逆天”的设计是不能放到计算机上的，由于服务器要同时和其他很多个电脑进行通信，也就是说服务器这个“公共电话”上会同时有很多个人希望用这台电话，让这些人排队等待那简直是灾难性的。因此计算机上出现了**端口**这一概念。它就像给同一部电话接上了很多条电话线，一条电话线就是一个端口。如果当前某条电话线占线了，那么他就可以从另一条电话线打进来到同一个电话，那么在已经有人使用电话的时候，后来的人就可以拿起其他的电话线打电话而互不干扰，这样就实现让同一台电话允许很多人同时打电话了。在计算机上，一共有固定65536个端口，也就是65536条“电话线”（好多线啊，但是没关系，这些“电话线”都是虚拟的）。“电话线”也需要编号，“电话线的编号”“就是**端口号**，范围是0到65535。IP地址就是电话机，端口就是电话机上的一条电话线，那么IP地址和端口在一起就指定了特定电话上的一条特定的电话线。这样的一个组合就叫**套接字**。有了电话号（IP地址）和电话线编号（端口号），你就可以拨通对方的电话了。你拨打那个电话的那条电话线的行为就叫**访问**。  
在平时打电话的时候，对方接到你的电话时，也能看到你的电话号。对于你来说，给别人打电话的时候同样也需要分成很多个电话线，因为你需要用不同的电话线同时给不同的人打电话。这样一来，如果你要给别人打电话，那么你必须拥有一个有电话号的电话，并且使用那6万多条电话线中的一根给对方打电话过去。在网络上也是一样，当你的客户端访问服务端时，你也需要一个IP地址（电话号）和一个端口号（电话线编号），才能给对方打过去电话。  
让我们用带端口的java版服务器的连接地址再解释一下这个问题：假设有一个这样的连接地址：11.4.5.14:19810，在这个地址中，11.4.5.14就是一个IP地址，19810就是一个端口号，而整个这个连接地址就是一个套接字。  
## 服务器、服务端和服务
继续上文的例子，如果要打给**服务器**这个“公共电话”，“公共电话”的电话线另一头必须得有一个人接电话才行，这个接电话的人就是**服务端**，在计算机上通常是一个程序。如果没有这个接电话的人，你就拨不通这条电话线。为了让你打电话后对面接电话的人一定是那人，那人暂时地占领了这条电话线，拒绝其他人使用这条电话线，这个占领电话线的行为就叫**绑定**（绑定到端口或者说绑定到套接字）。这也是为什么你在服务器上有时操作失误会见到报错“每个套接字只允许使用一次”。此外你拨了电话，肯定是有事要找电话对面的那个人谈。你们所交谈的这个话题就是**服务**，从对方得知你们交谈的内容到他来到电话线另一端等待的过程就是**开启服务**。  
让我们再整理一下整件事的脉络：你找一个人（服务端）要和他谈一件事（服务），于是这人为了能接到你的电话，来到了电话线另一头（服务端启动），并暂时占有了这条电话线（绑定端口），此时他已经做好了接听你电话的所有准备（开启服务）。你（客户端）想给那人打电话时，首先用对方的电话号（IP地址）和电话线编号（端口号）组合成一段代码（套接字）输入到自己的电话里拨打出去（访问）。  
反过来再讲一遍：服务端启动（对方来到电话线另一头），绑定端口（占有电话线），然后开启了服务（开始等你打来电话跟他讨论某事）。客户端使用由IP地址和端口组成的套接字访问服务器上的服务。（用电话号和电话线编号拨打电话和对方交流一件事）  
## IPv4的枯竭和IPv6推广的层层阻力
什么是IPv4和IPv6？在上文的网络五层模型中，我们知道IP是一种协议，而且在IP地址的讲解中，我们知道IP地址是IP协议中的一个概念。协议是可以分为版本的，而IP协议也一样。网际协议版本4，也就是IP协议的第四个版本，就是传说中的IPv4。同理，IPv6就是IP协议的第六版。IPv4规定IP地址使用四个255以内的数字组成，用小数点分开，也就有了现在最常见的IP地址形式，例如“192.168.0.1”、“127.0.0.1”、“114.114.114.114”、“60.17.61.243”。IPv6规定IP地址使用八个ffff以内的十六进制数字（除了0-9还有a-f）组成，也就有了那种“你看起来很奇怪但人家确实是IP地址”的地址，例如“fe80::1”、“::1”、“240c::6666”、“240e:3a5:183a:dcb0:114:514:1919:810”。在表示套接字时，IPv4直接在地址后面用冒号连接端口号即可，如11.4.5.14:19810。但是IPv6地址由于本身就已经使用冒号表示，在表示套接字时需要将IP地址用中括号括起来，再在后面加上冒号，如[240e:3a5:183a:dcb0:114:514:1919:810]:19810。  
> [!TIP]
> 每个IP协议版本IP地址格式的例子中，第一个是局域网IP，第二个是本地回环地址，第三个是著名的DNS服务器，第四个是世界上某个人上网时正在使用的IP地址。

从IPv4的格式可以看出，IPv4共可以表示4,294,967,296（40亿）个地址。然而由于一些特殊的规定，如192.168开头的IP地址只能用于内网，实际可以分配给互联网上计算机的IP地址远比总量要少。本来40亿地址就不够地球上70亿人每人一个，更不幸的是，这些IP地址的分配还不均匀。美国的国防部和贝尔实验室就拥有上亿个IPv4地址，至于整个中国大陆拥有约4亿个，虽然很多，但是远不够14亿人分配。为了让IPv4够分，出现了NAT技术。NAT的原理是将一些电脑组成一个局域网，然后不给它们分配公网IP，只让自己拥有公网IP。可是前面提到，打电话的人必须拥有电话号（IP地址），那没有在公网上的IP地址怎么给访问公网上其他的服务器呢？NAT的网关就给局域网中的所有电脑都分配局域网IP，然后让它们在访问互联网时经过自己。而被访问的服务器也是需要客户端的IP地址和端口的，此时NAT的网关就将客户端的电话线（端口）接到自己身上的一条电话线上（绑定到自己公网IP的一个端口），这样对于服务器来说，就是NAT网关把自己假扮成了客户端，然后应客户端的要求和服务器进行通信。  
这样电脑访问互联网上服务器的需求就解决了，可是如果NAT的局域网里有服务器该怎么办？这个服务器没有被分配到公网IP，其他客户端用什么访问他？NAT有两种方式可以实现服务器在公网提供服务：第一种叫端口映射，NAT网关主动把服务器上服务端开放服务的那根电话线（端口）接到（映射到）自己身上的一根电话线（端口上），这样局域网中特定服务器的特定端口就是NAT网关的公网IP上的一个端口，公网上其他客户端直接访问这个公网IP的这个端口，就可以访问到那个服务器上的特定服务了。第二种叫NAT打洞，与第一种方法不同的是，第一种NAT需要主动把服务器的局域网IP上的端口和自己在公网IP上的端口进行绑定，而这种方法完全不需要NAT主动做任何操作，只需要他进行正常的转换就可以了。上文提到NAT为了让局域网中的电脑访问公网上的服务器，需要把局域网中电脑上的“电话线”也就是端口接到自己在公网的“电话线”上，而这条电话线一旦接上，双方就可以进行双向通信了。那么就可以利用NAT的这个特性，首先让局域网中的服务器访问公网上的另一台服务器，让NAT去接上这根线，再让客户端也去访问公网上的那台服务器，让它的NAT也建立这个连接。两边连接建立好后，这个服务器告诉双方彼此的NAT为这些连接准备的端口号，双方就可以通过彼此的IP地址和已经接好的这根线，透过NAT愉快地连接了。  
随着互联网的发展，越来越多的人拥有了网络终端，而每个网络终端都需要一个IP地址来访问互联网。NAT技术出现后，很多路由器都具备了这个功能，因此每家只需要在自己办的宽带上接一个有NAT功能的路由器，然后把自己所有要上网的设备连接到这个路由器，就可以实现每户人家只需要一个IP地址。然而这样的人家越来越多，就算一家只给一个IP地址然后让所有人自行准备路由器来搭建NAT，IP地址也已经不够分了。于是运营商想了一个办法，他们自己准备了NAT网关，把几户人家的网线接到这个NAT网关下，就实现了这几户共用同一个公网IP。这下对于运营商来说，公网IP终于是够用了。可是对于这几户人家来说，自己搭建服务器却成了难题：虽然能控制自己的NAT网关，却无法控制运营商的NAT网关，由于端口映射需要NAT网关主动，这个方案就用不了了。此时NAT打洞的方案仍然可行，可是这个方案对于联网用途本身要求很高，首先它需要服务端和客户端软件都支持特定的NAT打洞方式，而且它还需要服务端和客户端采用特殊的协议进行通信，对于现有的大部分从未考虑过NAT打洞方案的软件来说，这个办法也行不通。就这样，被接到运营商的NAT下的设备就几乎都失去了成为服务器的能力。不过还好IP地址没到非常稀缺的程度，现在仍然有一些宽带可以分配到公网IP，也就能掌握位于公网的NAT网关的控制权，并通过端口映射方案在局域网中搭建服务器。  
造成以上种种现象的根本原因，其实就是IPv4太少了。为了解决这种现象，IPv6特意加长了表示方式，看那长长的地址就知道，IPv6的地址肯定是用不完了。事实上，IPv6的地址一共有3.4百万亿亿亿亿个，确实是分不完啊！难怪会有人说地球上的每一粒沙子都能分配到一个IPv6地址。IPv6的出现打破了层层NAT的现状，让每台电脑都能重新获得公网IP。然而IPv6由于和IPv4不兼容，在推广时遇到了大难题。首先是现有的老旧设备需要更新，因为它们不支持新的IPv6协议。很多软件也需要大改，因为它们是专为IPv4设计的。要从IPv4更换到IPv6，所需要进行的工作极其庞大，所以出现了IPv4和IPv6共存的方案，即双栈网络。支持双栈的设备既可以使用IPv4工作也可以使用IPv6工作，而且为了加速IPv4的淘汰，很多设备会刻意地默认使用IPv6上网，在IPv6无法使用时再使用IPv4。就这样，一段漫长的过渡阶段开始了。越来越多的设备和网络开始支持IPv6，可IPv4始终无法淘汰，因为旧设备和旧软件实在是太多了。  
可是近年来，据说IPv6的更新速度减缓了，据说主要是运营商尝到了NAT的甜头，因为套上运营商NAT后，用户就无法自行搭建服务器了，这样用户既不会用家用宽带提供未经审查的服务，也会被迫花更多钱去运营商那里购买昂贵的商用宽带，总地来说就是处处都利好了运营商，让他们既能给自己降低维护成本，又能让用户多给他们花钱。  
通常来说国内手机流量（移动数据）的网络环境在绝大部分地区已经支持IPv6。然而由于设备老旧或配置不当等原因，很多宽带（例如家里办的宽带，网吧、酒店、饭店等公共场所的免费wifi）都仍然不支持IPv6。如果你想知道自己正在使用的网络是否支持IPv6，可以访问这两个网站：ipw.cn和testipv6.cn，它们会告诉你你现在的网络对IPv6的支持情况。如果你的网络还不支持IPv6，你可以参考下一节的内容来开通IPv6。  
## 为家里的宽带开通IPv6和申请公网IPv4
## 商用宽带
## 内网穿透
## 上行困境
## 带宽的计算
## DDNS服务
## 选购域名
